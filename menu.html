<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proyectos</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --muted: #94a3b8;
        --text: #e5e7eb;
        --accent: #22c55e;
        --accent-2: #06b6d4;
        --danger: #ef4444;
        --border: #273043;
        --input-bg: #0b1220;
        --shadow: 0 8px 24px rgba(0,0,0,.35);
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f7fafc;
          --panel: #ffffff;
          --muted: #475569;
          --text: #0f172a;
          --accent: #16a34a;
          --accent-2: #0891b2;
          --danger: #dc2626;
          --border: #e5e7eb;
          --input-bg: #f8fafc;
          --shadow: 0 10px 30px rgba(2,6,23,.08);
        }
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 600px at 80% -10%, rgba(34,197,94,.15), transparent 60%),
                    radial-gradient(800px 500px at -10% 10%, rgba(6,182,212,.15), transparent 60%),
                    var(--bg);
        color: var(--text);
      }

      .nav {
        position: sticky; top: 0; z-index: 10;
        display: flex; align-items: center; justify-content: space-between;
        gap: 12px; padding: 16px 22px;
        background: color-mix(in oklab, var(--panel) 86%, transparent);
        border-bottom: 1px solid var(--border);
        backdrop-filter: blur(6px);
      }
      .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: .3px; }
      .brand .logo { width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: inset 0 0 0 2px rgba(255,255,255,.18); }
      .nav-actions { display: flex; align-items: center; gap: 8px; }
      .pill {
        padding: 8px 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--panel);
        color: var(--muted); font-size: 14px; display: inline-flex; align-items: center; gap: 8px;
      }

      .container { max-width: 1100px; margin: 28px auto; padding: 0 18px; }

      .grid { display: grid; grid-template-columns: 1fr 1.2fr; gap: 20px; }
      @media (max-width: 920px) { .grid { grid-template-columns: 1fr; } }

      .card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
      .card-header { padding: 18px 18px 10px; border-bottom: 1px solid var(--border); }
      .card-title { margin: 0; font-size: 18px; }
      .card-sub { margin: 6px 0 0; color: var(--muted); font-size: 13px; }
      .card-body { padding: 18px; }

      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      @media (max-width: 640px) { .row { grid-template-columns: 1fr; } }

      label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
      input[type="text"], textarea, input[type="url"] {
        width: 100%; padding: 12px 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--input-bg);
        color: var(--text); outline: none; transition: border .2s ease;
      }
      input:focus, textarea:focus { border-color: color-mix(in oklab, var(--accent) 65%, var(--border)); box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent); }
      textarea { resize: vertical; min-height: 84px; }

      .actions { display: flex; gap: 10px; flex-wrap: wrap; }
      .btn {
        padding: 10px 14px; border-radius: 12px; border: 1px solid var(--border); background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 70%, transparent), var(--panel));
        color: var(--text); cursor: pointer; font-weight: 600; letter-spacing: .2px; transition: transform .05s ease, background .3s ease, border-color .2s ease;
      }
      .btn:hover { transform: translateY(-1px); }
      .btn:active { transform: translateY(0); }
      .btn-primary { background: linear-gradient(135deg, color-mix(in oklab, var(--accent) 24%, var(--panel)), color-mix(in oklab, var(--accent-2) 20%, var(--panel))); border-color: color-mix(in oklab, var(--accent) 45%, var(--border)); }
      .btn-danger { background: linear-gradient(135deg, color-mix(in oklab, var(--danger) 24%, var(--panel)), color-mix(in oklab, var(--danger) 16%, var(--panel))); border-color: color-mix(in oklab, var(--danger) 45%, var(--border)); }
      .btn-secondary { background: linear-gradient(135deg, color-mix(in oklab, var(--accent-2) 16%, var(--panel)), color-mix(in oklab, var(--accent) 10%, var(--panel))); border-color: color-mix(in oklab, var(--accent-2) 38%, var(--border)); }

      .list-controls { display: flex; gap: 10px; align-items: center; justify-content: space-between; margin-bottom: 12px; flex-wrap: wrap; }
      .search { flex: 1 1 260px; }
      .empty { text-align: center; padding: 30px 14px; color: var(--muted); border: 1px dashed var(--border); border-radius: 12px; }

      .items { display: grid; gap: 10px; }
      .item { display: grid; grid-template-columns: 1fr auto; gap: 10px; padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--input-bg); align-items: center; }
      .item h4 { margin: 0; font-size: 16px; }
      .item p { margin: 4px 0 0; color: var(--muted); font-size: 13px; }
      .item-actions { display: flex; gap: 8px; }

      .hint { font-size: 12px; color: var(--muted); }
      .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--input-bg); border: 1px solid var(--border); padding: 2px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <header class="nav">
      <div class="brand">
        <span class="logo"></span>
        <span>Menú • Proyectos</span>
      </div>
      <div class="nav-actions">
        <span class="pill">Carpeta: <strong style="margin-left:6px">./javascript/</strong></span>
      </div>
    </header>

    <main class="container">
      <div class="grid">
        <section class="card">
          <div class="card-header">
            <h3 class="card-title">Nuevo proyecto</h3>
            <p class="card-sub">Agrega proyectos manualmente. Se guardan en tu navegador con <code>localStorage</code>.</p>
          </div>
          <div class="card-body">
            <form id="formProyecto">
              <input type="hidden" id="proyectoId" />
              <div class="row">
                <div>
                  <label for="nombre">Nombre</label>
                  <input type="text" id="nombre" placeholder="Mi app" required />
                </div>
                <div>
                  <label for="ruta">Ruta o URL</label>
                  <input type="text" id="ruta" placeholder="./mi-app/index.html" required />
                </div>
              </div>
              <div style="margin-top:12px">
                <label for="descripcion">Descripción (opcional)</label>
                <textarea id="descripcion" placeholder="Breve detalle del proyecto"></textarea>
              </div>
              <div class="actions" style="margin-top:14px">
                <button type="submit" class="btn btn-primary" id="btnGuardar">Guardar proyecto</button>
                <button type="button" class="btn" id="btnLimpiar">Limpiar</button>
              </div>
              <p class="hint" style="margin-top:10px">Sugerencia: usa rutas relativas desde esta página, por ejemplo <span class="kbd">./carpeta/index.html</span>.</p>
            </form>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h3 class="card-title">Proyectos</h3>
            <p class="card-sub">Lista de proyectos guardados en tu navegador.</p>
          </div>
          <div class="card-body">
            <div class="list-controls">
              <input class="search" type="text" id="buscador" placeholder="Buscar por nombre o descripción..." />
              <div class="actions">
                <button class="btn btn-secondary" id="btnExportar" title="Exportar a JSON">Exportar</button>
                <button class="btn" id="btnImportar" title="Importar desde JSON">Importar</button>
                <button class="btn btn-danger" id="btnBorrarTodo" title="Eliminar todos">Vaciar</button>
              </div>
            </div>
            <div id="lista" class="items"></div>
            <template id="tplItem">
              <div class="item">
                <div>
                  <h4 data-field="nombre"></h4>
                  <p data-field="descripcion"></p>
                  <p class="hint" data-field="ruta"></p>
                </div>
                <div class="item-actions">
                  <button class="btn" data-action="editar">Editar</button>
                  <a class="btn btn-primary" data-action="abrir" href="#" target="_blank" rel="noopener">Abrir</a>
                  <button class="btn btn-danger" data-action="eliminar">Eliminar</button>
                </div>
              </div>
            </template>
          </div>
        </section>
      </div>
    </main>

    <input type="file" id="fileInput" accept="application/json" hidden />

    <script>
      const KEY = 'js_proyectos';

      /** @type {{ id:string, nombre:string, ruta:string, descripcion?:string }[]} */
      let proyectos = [];

      const $ = (sel, ctx=document) => ctx.querySelector(sel);
      const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

      function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2, 7); }

      function cargar() {
        try { proyectos = JSON.parse(localStorage.getItem(KEY) || '[]'); }
        catch { proyectos = []; }
      }

      function guardar() {
        localStorage.setItem(KEY, JSON.stringify(proyectos));
      }

      function render(filtro='') {
        const cont = $('#lista');
        cont.innerHTML = '';
        const data = filtro
          ? proyectos.filter(p => (p.nombre+" "+(p.descripcion||'')).toLowerCase().includes(filtro.toLowerCase()))
          : proyectos;
        if (!data.length) {
          cont.innerHTML = `<div class="empty">No hay proyectos guardados.</div>`;
          return;
        }
        const tpl = $('#tplItem');
        data.forEach(p => {
          const node = tpl.content.firstElementChild.cloneNode(true);
          node.querySelector('[data-field="nombre"]').textContent = p.nombre;
          node.querySelector('[data-field="descripcion"]').textContent = p.descripcion || '';
          node.querySelector('[data-field="ruta"]').textContent = p.ruta;
          node.querySelector('[data-action="abrir"]').href = p.ruta;

          node.querySelector('[data-action="editar"]').addEventListener('click', () => {
            $('#proyectoId').value = p.id;
            $('#nombre').value = p.nombre;
            $('#ruta').value = p.ruta;
            $('#descripcion').value = p.descripcion || '';
            $('#btnGuardar').textContent = 'Actualizar proyecto';
            window.scrollTo({ top: 0, behavior: 'smooth' });
          });

          node.querySelector('[data-action="eliminar"]').addEventListener('click', () => {
            if (!confirm(`¿Eliminar "${p.nombre}"?`)) return;
            proyectos = proyectos.filter(x => x.id !== p.id);
            guardar();
            render($('#buscador').value);
          });

          cont.appendChild(node);
        });
      }

      function resetForm() {
        $('#proyectoId').value = '';
        $('#nombre').value = '';
        $('#ruta').value = '';
        $('#descripcion').value = '';
        $('#btnGuardar').textContent = 'Guardar proyecto';
      }

      // Eventos
      $('#formProyecto').addEventListener('submit', (e) => {
        e.preventDefault();
        const id = $('#proyectoId').value || uid();
        const nombre = $('#nombre').value.trim();
        const ruta = $('#ruta').value.trim();
        const descripcion = $('#descripcion').value.trim();
        if (!nombre || !ruta) return alert('Completa nombre y ruta.');

        const idx = proyectos.findIndex(p => p.id === id);
        if (idx >= 0) {
          proyectos[idx] = { ...proyectos[idx], nombre, ruta, descripcion };
        } else {
          proyectos.push({ id, nombre, ruta, descripcion });
        }
        guardar();
        resetForm();
        render($('#buscador').value);
      });

      $('#btnLimpiar').addEventListener('click', resetForm);
      $('#buscador').addEventListener('input', (e) => render(e.target.value));

      $('#btnBorrarTodo').addEventListener('click', () => {
        if (!proyectos.length) return;
        if (!confirm('¿Vaciar todos los proyectos?')) return;
        proyectos = [];
        guardar();
        render($('#buscador').value);
      });

      // Exportar / Importar
      $('#btnExportar').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(proyectos, null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'proyectos.json';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      const fileInput = $('#fileInput');
      $('#btnImportar').addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', async () => {
        const [file] = fileInput.files || [];
        if (!file) return;
        try {
          const text = await file.text();
          const data = JSON.parse(text);
          if (!Array.isArray(data)) throw new Error('Formato no válido');
          // Unir por id (o crear nuevas ids si faltan)
          const map = new Map(proyectos.map(p => [p.id, p]));
          data.forEach(p => {
            const id = p.id || uid();
            map.set(id, { id, nombre: p.nombre || 'Sin nombre', ruta: p.ruta || './', descripcion: p.descripcion || '' });
          });
          proyectos = Array.from(map.values());
          guardar();
          render($('#buscador').value);
          alert('Importación completada');
        } catch (err) {
          alert('No se pudo importar: ' + (err?.message || err));
        } finally {
          fileInput.value = '';
        }
      });

      // Init
      cargar();
      render();
    </script>
  </body>
  </html>
